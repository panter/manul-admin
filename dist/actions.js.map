{"version":3,"sources":["../src/actions.js"],"names":["manulAdmin","gotoCreate","collectionName","gotoRoute","adminContext","getCreateRoute","name","gotoEdit","_id","getEditRoute","gotoList","getListRoute","listSortToggle","newSortProperty","LocalState","localStateSortProperties","sortProperties","get","oldProperty","s","id","newSortProps","sortAscending","set","listSetSort","listSetFilter","filter","listSetSearchTerm","searchTerm","pageProperties","currentPage","listSetPageProperties","listGotoPage","listGotoNextPage","listGotoPreviousPage","update","doc","methods","Alerts","onSuccess","handleCallback","bind","call","props","error","create","destroy","confirmed","window","confirm","exportCsv","i18n","config","filename","onProgress","onCompleted","options","methodProps","collectionConfig","collections","columnsExport","columns","listCount","countError","totalCount","allDocs","console","pageSize","_onExportCompleted","exportAsCsv","data","keys","map","column","nullValues","nullValue","transforms","transform","columnTitles","t","k","_fetchChunk","list","listType","listError","result","docs","progress","length","importCsv","file","onInsert","onUpdate","onComplete","counter","imported","parse","header","dynamicTyping","complete","forEach","index","checkForComplete","add","size","entry","unflatten","entryUncleaned","value"],"mappings":"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","file":"actions.js","sourcesContent":["import { find } from 'lodash/fp';\nimport Papa from 'papaparse';\nimport _ from 'lodash';\nimport flat from 'flat';\n\nimport {\n  stateListFilter,\n  stateListSort,\n  statePageProperties,\n  stateListSearch\n} from './utils/local_state_utils';\nimport FallbackAlerts from './fallback_alerts';\nimport csv from './utils/csv';\nimport routeUtils from './utils/route_utils';\nimport { filterColumns, getColumnTitleI18nKey } from './utils/column_utils';\n\nexport default {\n  manulAdmin: {\n    gotoCreate(\n      {\n        adminContext: { gotoRoute }\n      },\n      collectionName\n    ) {\n      gotoRoute(routeUtils.getCreateRoute(collectionName).name);\n    },\n    gotoEdit(\n      {\n        adminContext: { gotoRoute }\n      },\n      collectionName,\n      _id\n    ) {\n      gotoRoute(routeUtils.getEditRoute(collectionName).name, { _id });\n    },\n    gotoList(\n      {\n        adminContext: { gotoRoute }\n      },\n      collectionName\n    ) {\n      gotoRoute(routeUtils.getListRoute(collectionName).name);\n    },\n    // sortProperty is according to react-griddle\n    listSortToggle({ LocalState }, collectionName, newSortProperty) {\n      const localStateSortProperties = stateListSort(collectionName);\n      const sortProperties = LocalState.get(localStateSortProperties) || [];\n      const oldProperty = find(s => s.id === newSortProperty.id)(\n        sortProperties\n      );\n      let newSortProps = [];\n\n      if (!oldProperty) {\n        newSortProps = [{ ...newSortProperty, sortAscending: true }];\n      } else {\n        newSortProps = _.without(sortProperties, oldProperty);\n        if (oldProperty.sortAscending) {\n          newSortProps = [{ ...newSortProperty, sortAscending: false }];\n        }\n      }\n      LocalState.set(localStateSortProperties, newSortProps);\n    },\n    listSetSort({ LocalState }, collectionName, sortProperties) {\n      LocalState.set(stateListSort(collectionName), sortProperties);\n    },\n    listSetFilter({ LocalState }, collectionName, filter) {\n      LocalState.set(stateListFilter(collectionName), filter);\n    },\n    listSetSearchTerm({ LocalState }, collectionName, searchTerm) {\n      // reset pagination if changed\n      const pageProperties = LocalState.get(\n        statePageProperties(collectionName)\n      );\n      LocalState.set(statePageProperties(collectionName), {\n        ...pageProperties,\n        currentPage: 1\n      });\n      LocalState.set(stateListSearch(collectionName), searchTerm);\n    },\n    listSetPageProperties({ LocalState }, collectionName, pageProperties) {\n      LocalState.set(statePageProperties(collectionName), pageProperties);\n    },\n    listGotoPage({ LocalState }, collectionName, currentPage) {\n      const pageProperties = LocalState.get(\n        statePageProperties(collectionName)\n      );\n      LocalState.set(statePageProperties(collectionName), {\n        ...pageProperties,\n        currentPage\n      });\n    },\n    listGotoNextPage({ LocalState }, collectionName) {\n      const pageProperties = LocalState.get(\n        statePageProperties(collectionName)\n      );\n      LocalState.set(statePageProperties(collectionName), {\n        ...pageProperties,\n        currentPage: pageProperties.currentPage + 1\n      });\n    },\n    listGotoPreviousPage({ LocalState }, collectionName) {\n      const pageProperties = LocalState.get(\n        statePageProperties(collectionName)\n      );\n      LocalState.set(statePageProperties(collectionName), {\n        ...pageProperties,\n        currentPage: pageProperties.currentPage - 1\n      });\n    },\n    update(\n      {\n        adminContext: { methods, gotoRoute },\n        Alerts = FallbackAlerts\n      },\n      collectionName,\n      doc,\n      onSuccess = () => gotoRoute(routeUtils.getListRoute(collectionName).name)\n    ) {\n      const handleCallback =\n        (Alerts.handleCallback && Alerts.handleCallback.bind(Alerts)) ||\n        FallbackAlerts.handleCallback.bind(FallbackAlerts);\n      methods[collectionName].update.call(\n        doc,\n        handleCallback(\n          'admin.update',\n          { props: () => ({ collectionName, doc }) },\n          error => {\n            if (!error) {\n              onSuccess({ collectionName, doc, _id: doc._id });\n            }\n          }\n        )\n      );\n    },\n    create(\n      {\n        adminContext: { methods, gotoRoute },\n        Alerts = FallbackAlerts\n      },\n      collectionName,\n      doc,\n      onSuccess = ({ _id }) =>\n        gotoRoute(routeUtils.getEditRoute(collectionName).name, { _id })\n    ) {\n      const handleCallback =\n        (Alerts.handleCallback && Alerts.handleCallback.bind(Alerts)) ||\n        FallbackAlerts.handleCallback.bind(FallbackAlerts);\n      methods[collectionName].create.call(\n        doc,\n        handleCallback(\n          'admin.create',\n          { props: () => ({ collectionName, doc }) },\n          (error, _id) => {\n            if (!error) {\n              onSuccess({ collectionName, _id });\n            }\n          }\n        )\n      );\n    },\n    destroy(\n      {\n        adminContext: { methods, gotoRoute },\n        Alerts = FallbackAlerts\n      },\n      collectionName,\n      _id,\n      onSuccess = () => gotoRoute(routeUtils.getListRoute(collectionName).name)\n    ) {\n      /* eslint no-alert: 0*/\n      const confirmed = window.confirm(\"Really destroy? This can't be undone\");\n      const handleCallback =\n        (Alerts.handleCallback && Alerts.handleCallback.bind(Alerts)) ||\n        FallbackAlerts.handleCallback.bind(FallbackAlerts);\n      if (confirmed) {\n        methods[collectionName].destroy.call(\n          { _id },\n          handleCallback(\n            'admin.destroy',\n            { props: () => ({ collectionName, _id }) },\n            error => {\n              if (!error) {\n                onSuccess({ collectionName, _id });\n              }\n            }\n          )\n        );\n      }\n    },\n    exportCsv(\n      {\n        i18n,\n        adminContext: { methods, config },\n        Alerts = FallbackAlerts\n      },\n      { collectionName, filter, searchTerm, sortProperties },\n      { filename = 'export.csv', onProgress, onCompleted, ...options } = {}\n    ) {\n      const methodProps = {\n        filter,\n        searchTerm,\n        sortProperties\n      };\n      const collectionConfig = config.collections[collectionName];\n      const columnsExport = filterColumns(collectionConfig.columns, 'export');\n      methods[collectionName].listCount.call(\n        methodProps,\n        (countError, totalCount) => {\n          let allDocs = [];\n          if (countError) {\n            console.error(countError);\n          }\n\n          let currentPage = 1;\n          const pageSize = 1000;\n          const _onExportCompleted = () => {\n            csv.exportAsCsv({\n              filename,\n              data: allDocs,\n              keys: columnsExport.map(\n                column => (typeof column === 'string' ? column : column.id)\n              ),\n              nullValues: columnsExport.map(\n                column =>\n                  typeof column === 'string' ? '' : column.nullValue || ''\n              ),\n              transforms: columnsExport.map(column => column.transform || null),\n              columnTitles: columnsExport\n                .map(column =>\n                  getColumnTitleI18nKey({\n                    collectionName,\n                    collectionConfig,\n                    column\n                  })\n                )\n                .map(k => (i18n ? i18n.t([`${k}.label`, k]) : k)),\n\n              ...options\n            });\n            if (onCompleted) onCompleted();\n          };\n          const _fetchChunk = () => {\n            const pageProperties = {\n              currentPage,\n              pageSize\n            };\n            methods[collectionName].list.call(\n              {\n                ...methodProps,\n                pageProperties,\n                listType: 'export'\n              },\n              (listError, result) => {\n                allDocs = [...allDocs, ...result.docs];\n                const progress = allDocs.length / totalCount;\n                if (onProgress) {\n                  onProgress(progress);\n                }\n                if (result.docs.length === 0 || allDocs.length >= totalCount) {\n                  _onExportCompleted();\n                } else {\n                  currentPage += 1;\n                  _fetchChunk();\n                }\n              }\n            );\n          };\n          _fetchChunk();\n        }\n      );\n    },\n    importCsv(\n      {\n        adminContext: { methods }\n      },\n      {\n        collectionName,\n        file,\n        onInsert = _.noop,\n        onUpdate = _.noop,\n        onComplete = _.noop\n      }\n    ) {\n      let counter = -1;\n      const imported = new Set();\n      Papa.parse(file, {\n        header: true,\n        dynamicTyping: true,\n        complete({ data }) {\n          data.forEach(entryUncleaned => {\n            counter += 1;\n            const index = counter; // need constant closure copy\n            const checkForComplete = () => {\n              imported.add(index);\n              if (imported.size === data.length) {\n                onComplete();\n              }\n            };\n            // console.log('uncleaned', entryUncleaned);\n            const entry = flat.unflatten(\n              _.omitBy(entryUncleaned, value => value === 'NULL')\n            );\n            // console.log('cleaned', entry);\n            if (entry._id) {\n              methods[collectionName].update.call(entry, error => {\n                onUpdate(index, error, entry);\n                checkForComplete();\n              });\n            } else {\n              delete entry._id; // if falsy\n              methods[collectionName].create.call(entry, (error, _id) => {\n                onInsert(index, error, { _id, ...entry });\n                checkForComplete();\n              });\n            }\n          });\n        }\n      });\n    }\n  }\n};\n"]}