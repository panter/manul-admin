{"version":3,"sources":["../../src/initMethods/create.js"],"names":["collectionName","collectionConfig","ValidatedMethod","Meteor","name","validate","allowInsertWithId","collection","simpleSchema","extend","_id","type","String","optional","validator","clean","run","doc","userId","Error","insert"],"mappings":";;;;;;AACA;;;;;;kBAQe,gBAEbA,cAFa,EAGbC,gBAHa;AAAA,MACXC,eADW,QACXA,eADW;AAAA,MACMC,MADN,QACMA,MADN;AAAA,SAKb,IAAID,eAAJ,CAAoB;AAClBE,0BAAoBJ,cAApB,YADkB;AAElBK,cAAU,CAACJ,iBAAiBK,iBAAjB,GACPL,iBAAiBM,UAAjB,CAA4BC,YAA5B,GAA2CC,MAA3C,CAAkD;AAChDC,WAAK,EAAEC,MAAMC,MAAR,EAAgBC,UAAU,IAA1B;AAD2C,KAAlD,CADO,GAIPZ,iBAAiBM,UAAjB,CAA4BC,YAA5B,EAJM,EAKRM,SALQ,CAKE,EAAEC,OAAO,IAAT,EALF,CAFQ;AAQlBC,OARkB,eAQdC,GARc,EAQT;AACP;AACA,UAAI,CAAC,0BAAUjB,cAAV,EAA0B,KAAKkB,MAA/B,CAAL,EAA6C;AAC3C,cAAM,IAAIf,OAAOgB,KAAX,CAAiB,aAAjB,EAAgC,qBAAhC,CAAN;AACD;AACD,aAAOlB,iBAAiBM,UAAjB,CAA4Ba,MAA5B,CAAmCH,GAAnC,CAAP;AACD;AAdiB,GAApB,CALa;AAAA,C","file":"create.js","sourcesContent":["// @flow\nimport isAllowed from '../is_allowed';\n\nimport type {\n  MethodsContextT,\n  CollectionNameT,\n  CollectionConfigT\n} from '../types';\n\nexport default (\n  { ValidatedMethod, Meteor }: MethodsContextT,\n  collectionName: CollectionNameT,\n  collectionConfig: CollectionConfigT\n) =>\n  new ValidatedMethod({\n    name: `manulAdmin.${collectionName}.create`,\n    validate: (collectionConfig.allowInsertWithId\n      ? collectionConfig.collection.simpleSchema().extend({\n          _id: { type: String, optional: true }\n        })\n      : collectionConfig.collection.simpleSchema()\n    ).validator({ clean: true }),\n    run(doc) {\n      // console.log('inserting', doc);\n      if (!isAllowed(collectionName, this.userId)) {\n        throw new Meteor.Error('not allowed', 'You are not allowed');\n      }\n      return collectionConfig.collection.insert(doc);\n    }\n  });\n"]}