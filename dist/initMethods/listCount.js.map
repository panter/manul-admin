{"version":3,"sources":["../../src/initMethods/listCount.js"],"names":["context","collectionName","collectionConfig","ValidatedMethod","name","validate","validator","clean","run","listOptions","userId","Meteor","Error","isClient","docs","count","unblock","getDocuments"],"mappings":";;;;;;;;;;;;;;AAEA;;;;AAOA;;AAEA;;;;;;kBAEe,UACbA,OADa,EAEbC,cAFa,EAGbC,gBAHa;AAAA,SAKb,IAAIF,QAAQG,eAAZ,CAA4B;AAC1BC,0BAAoBH,cAApB,eAD0B;AAE1BI,cAAU,oBAAWC,SAAX,CAAqB,EAAEC,OAAO,KAAT,EAArB,CAFgB;AAGpBC,OAHoB,eAGhBC,WAHgB,EAGH;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,oBAChB,0BAAUR,cAAV,EAA0B,MAAKS,MAA/B,CADgB;AAAA;AAAA;AAAA;;AAAA,sBAEb,IAAIV,QAAQW,MAAR,CAAeC,KAAnB,CAAyB,aAAzB,EAAwC,qBAAxC,CAFa;;AAAA;AAAA,qBAIjBZ,QAAQW,MAAR,CAAeE,QAJE;AAAA;AAAA;AAAA;;AAAA,iDAKZ,EAAEC,MAAM,EAAR,EAAYC,OAAO,CAAnB,EALY;;AAAA;AAOrB,sBAAKC,OAAL;AAPqB;AAAA,uBAQG,6BAAc;AACpChB,kCADoC;AAEpCE,oDAFoC;AAGpCD,gDAHoC;AAIpCQ,0CAJoC;AAKpCQ,gCAAc;AALsB,iBAAd,CARH;;AAAA;AAAA;AAQbF,qBARa,QAQbA,KARa;AAAA,iDAedA,KAfc;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBtB;AAnByB,GAA5B,CALa;AAAA,C","file":"listCount.js","sourcesContent":["// @flow\n\nimport isAllowed from '../is_allowed';\n\nimport type {\n  MethodsContextT,\n  CollectionNameT,\n  CollectionConfigT\n} from '../types';\nimport { ListSchema } from '../schemas';\n\nimport getListResult from './getListResult';\n\nexport default (\n  context: MethodsContextT,\n  collectionName: CollectionNameT,\n  collectionConfig: CollectionConfigT\n) =>\n  new context.ValidatedMethod({\n    name: `manulAdmin.${collectionName}.listCount`,\n    validate: ListSchema.validator({ clean: false }),\n    async run(listOptions) {\n      if (!isAllowed(collectionName, this.userId)) {\n        throw new context.Meteor.Error('not allowed', 'You are not allowed');\n      }\n      if (context.Meteor.isClient) {\n        return { docs: [], count: 0 };\n      }\n      this.unblock();\n      const { count } = await getListResult({\n        context,\n        collectionConfig,\n        collectionName,\n        listOptions,\n        getDocuments: false\n      });\n      return count;\n    }\n  });\n"]}