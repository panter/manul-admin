{"version":3,"sources":["../src/init_admin_server.js"],"names":["config","Meteor","ValidatedMethod","SimpleSchema","isAllowed","collections","createPublication","getPublications","name","edit","collection","publish","publishEdit","_id","userId","find","createPublications","forEach"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA;;AAEA;;;kBAGe,gBAAmDA,MAAnD,EAA8D;AAAA,MAA3DC,MAA2D,QAA3DA,MAA2D;AAAA,MAAnDC,eAAmD,QAAnDA,eAAmD;AAAA,+BAAlCC,YAAkC;AAAA,MAAlCA,YAAkC,qCAAnB,IAAmB;;AAC3E,MAAMC,YAAY,0BAAUJ,MAAV,CAAlB;AAD2E,MAEnEK,WAFmE,GAEnDL,MAFmD,CAEnEK,WAFmE;;;AAI3E,MAAMC,oBAAoB,SAApBA,iBAAoB,OAAQ;AAAA,gCACf,4BAAiBC,eAAjB,CAAiCC,IAAjC,CADe;AAAA,QACxBC,IADwB,yBACxBA,IADwB;;AAAA,QAExBC,UAFwB,GAETL,YAAYG,IAAZ,CAFS,CAExBE,UAFwB;;AAIhC;;AACAT,WAAOU,OAAP,CAAeF,IAAf,EAAqB,SAASG,WAAT,CAAqBC,GAArB,EAA0B;AAC7C,UAAIT,UAAUI,IAAV,EAAgB,KAAKM,MAArB,CAAJ,EAAkC;AAChC,eAAOJ,WAAWK,IAAX,CAAgBF,GAAhB,CAAP;AACD;AACF,KAJD;AAKD,GAVD;AAWA,MAAMG,qBAAqB,SAArBA,kBAAqB,GAAM;AAC/B,wBAAYX,WAAZ,EAAyBY,OAAzB,CAAiCX,iBAAjC;AACD,GAFD;AAGAU;AACA,gCAAc,EAAEf,cAAF,EAAUC,gCAAV,EAA2BC,0BAA3B,EAAd,EAAyDH,MAAzD;AACD,C","file":"init_admin_server.js","sourcesContent":["import IsAllowed from './is_allowed';\nimport createMethods from './create_methods';\nimport publicationUtils from './utils/publication_utils';\n\n// SimpleSchema needs only to be passed, if its not in npm (version 2)\n\n/**\nupdate: we no longer publish list, because we use a method call for that\n*/\nexport default ({ Meteor, ValidatedMethod, SimpleSchema = null }, config) => {\n  const isAllowed = IsAllowed(config);\n  const { collections } = config;\n\n  const createPublication = name => {\n    const { edit } = publicationUtils.getPublications(name);\n    const { collection } = collections[name];\n\n    /* eslint meteor/audit-argument-checks: 0*/\n    Meteor.publish(edit, function publishEdit(_id) {\n      if (isAllowed(name, this.userId)) {\n        return collection.find(_id);\n      }\n    });\n  };\n  const createPublications = () => {\n    Object.keys(collections).forEach(createPublication);\n  };\n  createPublications();\n  createMethods({ Meteor, ValidatedMethod, SimpleSchema }, config);\n};\n"]}